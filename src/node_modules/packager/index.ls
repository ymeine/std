require! {
	node-path: path

	object: 'object/core'
	array: 'array/core'
}



exportValues = (exports, values) ->
	for value in values
		{
			value
			names
		} = value

		# ---------------------------------------------------------------- value

		if not value? => continue
		# if _from? => value = _from.value

		# ---------------------------------------------------------------- names

		names = array.factory names

		# Processing -----------------------------------------------------------

		object.alias value, names, exports, yes



exportModules = (module, submodules, usePathAsName, lazy) ->
	for submodule in submodules
		{
			path
			names
		} = submodule

		# ----------------------------------------------------------------- path

		if not path? => continue

		# ---------------------------------------------------------------- names

		names = array.factory names
		if usePathAsName
			names = [node-path.basename path] ++ names

		# Not lazy mode --------------------------------------------------------

		{exports} = module

		if not lazy
			value = module.require path
			object.alias value, names, exports, yes

		# Lazy mode ------------------------------------------------------------

		else let module, path
			descriptor = {
				get: -> module.require path
				+enumerable
				+configurable
			}
			for name in names
				Object.defineProperty exports, name, descriptor



_export = (spec) ->
	# Input processing ---------------------------------------------------------

	{
		module
		submodules
		values
		# from: _from

		# Options
		lazy
		usePathAsName
	} = spec

	# ------------------------------------------------------------------- module

	if not module? => throw Error 'No module given'

	# --------------------------------------------------------------- submodules

	submodules = switch typeof! submodules
	| 'Array' => submodules
	| 'Object' => [{path, names} for path, names of submodules]
	| _ => []

	# ------------------------------------------------------------------- values

	values = array.factory values

	# ------------------------------------------------------------------ options

	lazy ?= yes
	usePathAsName ?= yes

	# Processing ---------------------------------------------------------------

	exportModules module, submodules, usePathAsName, lazy
	exportValues module.exports, values



_export {
	module

	values: [
		{
			value: _export
			names: <[
				export
				exports
			]>
		}
	]
}
